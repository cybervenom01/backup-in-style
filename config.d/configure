#!/bin/bash

###
## Error Handler
#

trap 'err_handle $? $LINENO' ERR

err_handle ()
{
	printf "$( uname -n ): Error: $1: On line $2"
}


###
## Main Configuration File.
###

###
## Variables Configuration
#

ROOT_UID=0
E_UID=1


###
## Check if the configuration file is run as root.
#

if [ "$UID" -ne "$ROOT_UID" ]
then
	printf "\n\n"
	printf "Please run this script with root privileges.\n\n"
	exit $E_UID
fi


###
## Searches for the commands which help to compress, archive, and remotely transfer your data.
#

printf "\nChecking if commands are installed: \n"

A_CMDS=( "tar" "zstd" "ssh" "scp" )

for CMDS in "${A_CMDS[@]}";
do
	printf "$CMDS . . .\n"

        if ! command -v "$CMDS" > /dev/null 2>&1;
        then
                printf "$CMDS not found\n"
                printf "Please install the corresponding packages.\n\n"
                exit 0
        fi
done

printf "Commands are installed.\n"


###
## Copy main script into /usr/local/bin
## Make sure it has the correct file permissions
## and its executable.
#

printf "Copying the script to /usr/local/bin.\n"
cp ../backup-in-style.sh /usr/local/bin/backupstyle

printf "Renaming and changing permissions for script.\n"
chmod 755 /usr/local/bin/backupstyle


###
## Copy the ASCII Art into the /usr/share/BKStyle directory
#

ASCIILOC="/usr/share"
BKDIR="backupstyle.d"
ASCIIDIR="asciiart"

printf "Creating BakupStyle.d directory.\n"
mkdir -p ${ASCIILOC}/$BKDIR/$ASCIIDIR

printf "Copying ascii art files to the directory.\n"
cp ../ascii/* ${ASCIILOC}/$BKDIR/$ASCIIDIR

printf "Changing permissions to the files and directory.\n"
chmod 755 /usr/share/$BKDIR
chmod 755 /usr/share/$BKDIR/$ASCIIDIR
chmod 644 /usr/share/$BKDIR/$ASCIIDIR/*

printf "\nYour backup script is ready.\n"
printf "Keep your data safe and secure.\n\n"

exit 0
